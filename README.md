# lsnr_clients
Script para analisar Log do Listener e gerar lista de IPs que conectaram no banco de dados Oracle

1) Acesso o servidor de banco de dados com o usuário que é dono do Listener (exemplo: grid)

2) Crie o script lsnr_clients.sh no servidor de banco de dados e cole o conteúdo do script.
 Se tiver acesso a internet, pode usar o comando abaixo para baixar o script:
 wget "https://raw.githubusercontent.com/maiconcarneiro/lsnr_clients/main/lsnr_clients.sh"; chmod +x lsnr_clients.sh

3) Execute o script no shell
Ex: sh lsnr_clients.sh

Parâmetros opcionais:
sh lsnr_clients.sh <intervalo> <gera contagem> <nome do servico> <nome do listener> 

Exemplo com todos os parâmetros:
sh lsnr_clients.sh 30 s XPTOPRD LISTENERPROD

Onde:
30 --> Intervalo de 30 dias (pega todos os arquivos de log com data de alteração nos últimos 30 dias)
s --> "Gera Contagem" = Sim   (apresenta um resumo com a quantidade de conexões originada a partir de cada IP)
XPTOPRD --> Considera somente conexõs para o SERVICE_NAME "XPTOPRD"
LISTENERPROD --> Analisa log do Listener "LISTENERPROD" (requerido somente quando quiser analisar um Listener diferente do primeiro que é encontrado automaticamente pelo script)


Exemplo do resultado:
$ ./lsnr_clients.sh 15 s
*********************************************************************************
Servidor..................: srv01
Data da análise...........: 12/01/2022 12:00:47
Útima modificação do log..: 15 (dias)
Nome do Listener..........: LISTENER
Dono do Listener..........: grid
Binário do Listener.......: /u02/app/12.2.0/grid/bin/tnslsnr
Service Name..............:

Arquivos de log analisados:
/u02/app/grid/diag/tnslsnr/srv01/listener/trace/listener.log

*********************************************************************************

=================================================================================
Log mais antigo...: ./listener.log:09-JAN-2022 03:38:54
Log mais recente..: ./listener.log:12-JAN-2022 12:00:47
=================================================================================


Lista de IPs identificados:
-----------------------

10.137.136.90
10.137.16.117
10.137.16.14
10.137.16.60
10.137.16.62
10.137.16.84
10.137.16.86
10.137.16.87
10.137.16.97
10.137.32.169
10.137.32.170
10.137.32.173
10.137.32.66
10.137.48.112
10.137.48.157
10.137.8.135
10.137.8.136
10.137.8.137
10.137.8.138
10.137.8.139
10.137.8.14
10.137.8.140
10.137.8.141
10.137.8.142
10.137.8.143
10.137.8.144
10.137.8.150
10.137.8.178
10.137.8.33
10.137.8.34
10.137.8.35
10.137.8.36
10.137.8.37
10.137.8.38
10.137.8.39
10.137.8.40
10.137.8.41
10.137.8.42
10.137.8.51
10.137.8.52
10.137.8.53
10.137.8.54
10.137.8.64
10.137.8.65
10.137.8.67
10.137.8.89
10.137.8.90
10.137.8.91
10.255.138.72
10.255.80.11
10.255.80.110
10.255.80.12
10.255.80.132
10.255.80.147
10.255.80.156
10.255.80.17
10.255.80.188
10.255.80.19
10.255.80.20
10.255.80.22
10.255.80.23
10.255.80.231
10.255.80.25
10.255.80.29
10.255.80.74
10.255.80.83
10.255.80.84
10.255.80.85
10.255.80.92
10.255.80.93
10.255.82.103
10.255.82.104
10.255.82.106
10.255.82.12
10.255.82.13
10.255.82.137
10.255.82.185
10.255.82.219
10.255.82.27
10.255.82.3
10.255.82.32
10.255.82.33
10.255.82.38
10.255.82.46
10.255.82.47
10.255.82.66
10.255.82.70
10.255.82.72
10.255.82.9
172.18.10.107
172.18.10.199
172.18.10.215
172.18.10.217
172.18.10.59
172.18.11.117
172.18.11.144
172.18.11.157
172.18.11.185
172.18.11.2
172.18.11.229
172.18.11.245
172.18.11.252
172.18.11.29
172.18.11.31
172.18.11.65
172.18.1.167
172.18.1.184
172.18.2.200
172.18.2.75
172.18.7.35
172.18.7.36
172.18.8.149
172.18.8.154
172.18.8.204
172.18.8.23
172.18.8.68
172.18.8.91
172.18.9.163
172.18.9.186

Contagem de conexões por IP:
===========================
      HOST        Qtde
===========================
10.255.80.147    1
10.255.82.3      1
172.18.11.144    1
172.18.11.2      1
172.18.11.245    1
172.18.11.252    1
172.18.11.29     1
172.18.1.167     1
172.18.1.184     1
172.18.2.200     1
172.18.7.35      1
172.18.8.149     1
172.18.9.163     1
172.18.9.186     1
10.255.138.72    2
10.255.80.110    2
10.255.80.188    2
10.255.80.231    2
10.255.82.185    2
10.255.82.219    2
10.255.82.27     2
10.255.82.72     2
172.18.11.157    2
172.18.11.229    2
172.18.8.23      2
10.137.32.169    3
10.137.32.170    3
10.137.48.157    3
172.18.10.217    3
172.18.10.59     3
172.18.8.204     3
10.255.82.46     4
172.18.10.107    4
172.18.11.117    4
172.18.11.65     4
172.18.8.154     4
172.18.10.215    5
172.18.2.75      5
10.137.136.90    6
10.137.8.90      6
172.18.10.199    6
10.137.8.144     7
10.255.80.74     7
10.255.82.70     7
10.137.16.62     9
172.18.11.185    9
10.255.82.32     10
10.255.82.9      10
172.18.11.31     10
10.137.48.112    11
172.18.8.68      12
172.18.7.36      13
10.137.8.143     16
10.137.8.91      17
10.137.16.87     20
172.18.8.91      21
10.137.8.40      27
10.137.8.39      40
10.255.80.17     42
10.255.80.25     44
10.255.80.83     47
10.255.82.33     47
10.255.82.103    48
10.255.82.13     49
10.137.8.37      50
10.255.80.20     50
10.255.80.11     51
10.255.80.93     51
10.255.82.12     51
10.255.80.22     53
10.255.82.106    54
10.255.80.92     55
10.255.80.156    56
10.255.80.29     56
10.255.80.12     58
10.255.80.84     59
10.255.80.85     59
10.255.82.66     60
10.255.80.23     63
10.255.82.137    63
10.255.82.38     64
10.255.80.132    67
10.137.8.38      78
10.255.82.47     79
10.255.80.19     92
10.255.82.104    132
10.137.8.67      350
10.137.16.84     385
10.137.32.66     538
10.137.8.136     830
10.137.8.135     916
10.137.8.137     949
10.137.16.14     979
10.137.8.53      1048
10.137.16.60     1056
10.137.16.97     1065
10.137.8.138     1157
10.137.8.41      1946
10.137.8.42      2392
10.137.8.64      2696
10.137.8.14      2769
10.137.8.65      3277
10.137.8.51      3389
10.137.8.52      3854
10.137.8.142     4938
10.137.8.89      5753
10.137.16.117    5783
10.137.8.54      7331
10.137.8.139     8791
10.137.8.141     10530
10.137.16.86     10601
10.137.8.36      14733
10.137.8.140     15701
10.137.8.33      16804
10.137.8.35      20848
10.137.8.150     23168
10.137.8.34      24438
10.137.8.178     120427
10.137.32.173    188709
===========================
Contagem concluída com sucesso.
